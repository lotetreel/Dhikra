const hadithData = {
  'wudhu': {
    'hadith1': {
      title: "وضوء | The Beautiful Way of Wudhu",
      steps: [
        {
          arabic: "بَيْنَا أَمِيرُ الْمُؤْمِنِينَ (عَلَيْهِ السَّلاَمُ) ذَاتَ يَوْمٍ جَالِساً مَعَ ابْنِ الْحَنَفِيَّةِ إِذْ قَالَ: يَا مُحَمَّدُ ائتِنِي بِإِنَاءٍ فِيهِ مَاءٌ أَتَوَضَّأْ لِلصَّلَاةِ",
          translation: "While the Commander of the Faithful (peace be upon him) was sitting one day with Ibn al-Hanafiyyah, he said: 'O Muhammad, bring me a vessel with water so I may perform ablution for prayer.'"
        },
        {
          arabic: "فَأتَاهُ مُحَمَّدٌ بِالْمَاءِ فَأَكْفَأَ بِيَدِهِ الْيُمْنَى عَلَى يَدِهِ الْيُسْرَى ثُمَّ قَالَ: بِسْمِ الله الْحَمْدُ للهِ الَّذِي جَعَلَ الْمَاءَ طَهُوراً وَلَمْ يَجْعَلْهُ نَجِساً",
          translation: "Muhammad brought him the water, and he poured his right hand over his left hand, then said: 'In the name of Allah. Praise be to Allah, Who made water purifying and not impure.'"
        },
        // Add other Wudhu steps from original question
      ]
    },
    'hadith2': {
      title: "وضوء | Wudhu Wisdom from the Prophet",
      steps: [
        {
          arabic: "هذا هو الحديث الثاني للوضوء، الخطوة الأولى",
          translation: "This is the second hadith, step one."
        },
        // Add other Wudhu steps from original question
      ]
    }
  },
  "sajjadiya": {
    "supplication1": {
      "title": "الصحيفة السجادية | Supplication on Confession",
      "steps": [
        {
          "arabic": "وَكَانَ مِنْ دُعَائِهِ عَلَيْهِ السَّلَامُ",
          "translation": "And among his supplications, peace be upon him,"
        },
        {
          "arabic": "فِي الِاعْتِرَافِ وَطَلَبِ التَّوْبَةِ إِلَى اللَّهِ تَعَالَى",
          "translation": "in confession and seeking repentance to Allah the Exalted:"
        },
        {
          "arabic": "اللَّهُمَّ إِنَّهُ يَحْجُبُنِي عَنْ مَسْأَلَتِكَ خِلَالٌ ثَلَاثٌ، وَتَحْدُونِي عَلَيْهَا خَلَّةٌ وَاحِدَةٌ",
          "translation": "O Allah, three flaws prevent me from asking You, yet one quality compels me to do so:"
        },
        {
          "arabic": "يَحْجُبُنِي أَمْرٌ أَمَرْتَ بِهِ فَأَبْطَأْتُ عَنْهُ، وَنَهْيٌ نَهَيْتَنِي عَنْهُ فَأَسْرَعْتُ إِلَيْهِ، وَنِعْمَةٌ أَنْعَمْتَ بِهَا عَلَيَّ فَقَصَّرْتُ فِي شُكْرِهَا",
          "translation": "I am hindered by a command You ordained that I delayed in fulfilling, a prohibition You warned against that I hastened to violate, and a blessing You bestowed that I failed to adequately thank You for."
        },
        {
          "arabic": "وَيَحْدُونِي عَلَى مَسْأَلَتِكَ تَفَضُّلُكَ عَلَى مَنْ أَقْبَلَ بِوَجْهِهِ إِلَيْكَ، وَوَفَدَ بِحُسْنِ ظَنِّهِ إِلَيْكَ",
          "translation": "What drives me to ask You is Your grace toward those who turn to You earnestly and approach You with good expectations."
        },
        {
          "arabic": "إِذْ جَمِيعُ إِحْسَانِكَ تَفَضُّلٌ، وَإِذْ كُلُّ نِعَمِكَ ابْتِدَاءٌ",
          "translation": "For all Your benevolence is pure favor, and every blessing You grant is initiated by You alone."
        },
        {
          "arabic": "فَهَا أَنَا ذَا، يَا إِلَهِي وَاقِفٌ بِبَابِ عِزِّكَ وُقُوفَ المُسْتَسْلِمِ الذَّلِيلِ، وَسَائِلُكَ عَلَى الحَيَاءِ مِنِّي سُؤَالَ البَائِسِ المُعِيلِ",
          "translation": "Here I am, my Lord, standing humbly at the door of Your majesty like a submissive servant, asking You—ashamed yet desperate—as a destitute beggar pleads."
        },
        {
          "arabic": "مُقِرٌّ لَكَ بِأَنِّي لَمْ أَسْتَسْلِمْ وَقْتَ إِحْسَانِكَ إِلَّا بِالْإِقْلَاعِ عَنْ عِصْيَانِكَ",
          "translation": "I confess that I only surrendered to You when compelled by abandoning my disobedience."
        },
        {
          "arabic": "وَلَمْ أَخْلُ فِي الحَالاتِ كُلِّهَا مِنِ امْتِنَانِكَ، فَهَلْ يَنْفَعُنِي، يَا إِلَهِي إِقْرَارِي عِنْدَكَ بِسُوءِ مَا اكْتَسَبْتُ، وَهَلْ يُنْجِينِي مِنْكَ اعْتِرَافِي لَكَ بِقَبِيحِ مَا ارْتَكَبْتُ",
          "translation": "Yet in all circumstances, Your grace never abandoned me. Will my admission of sins benefit me, O my God? Will my confession of transgressions save me from Your wrath?"
        },
        {
          "arabic": "أَمْ أَوْجَبْتَ لِي فِي مَقَامِي هَذَا سُخْطَكَ، أَمْ لَزِمَنِي فِي وَقْتِ دُعَايَ مَقْتُكَ.",
          "translation": "Or have You decreed anger toward me in this state? Has Your hatred become inevitable as I supplicate?"
        },
        {
          "arabic": "سُبْحَانَكَ لَا أَيْأَسُ مِنْكَ وَقَدْ فَتحْتَ لِي بَابَ التَّوْبَةِ إِلَيْكَ",
          "translation": "Glory be to You! I do not despair, for You have opened the door of repentance to me."
        },
        {
          "arabic": "بَلْ أَقُولُ مَقَالَ العَبْدِ الذَّلِيلِ الظَّالِمِ لِنَفْسِهِ، المُسْتَخِفِّ بِحُرْمَةِ رَبِّهِ",
          "translation": "Instead, I speak the words of a lowly servant who wronged himself and disrespected his Lord’s sanctity."
        },
        {
          "arabic": "الَّذِي عَظُمَتْ ذُنُوبُهُ فَجَلَّتْ، وَأَدْبَرَتْ أَيَّامُهُ، فَوَلَّتْ",
          "translation": "One whose sins grew immense, whose days passed by in heedlessness,"
        },
        {
          "arabic": "حَتَّى إِذَا رَأَى مُدَّةَ العَمَلِ قَدِ انْقَضَتْ وَغَايَةَ العُمُرِ قَدِ انْتَهَتْ",
          "translation": "until he saw his time for deeds expire and his lifespan reach its end,"
        },
        {
          "arabic": "وَأَيْقَنَ أَنَّهُ لَا مَحِيصَ لَهُ مِنْكَ، وَلَا مَهْرَبَ لَهُ عَنْكَ",
          "translation": "certain that there is no escape from You nor refuge except with You."
        },
        {
          "arabic": "تَلَقَّاكَ بِالْإِنَابَةِ، وَأَخْلَصَ لَكَ التَّوْبَةَ",
          "translation": "He meets You with sincere return and dedicates his repentance solely to You."
        },
        {
          "arabic": "فَقَامَ إِلَيْكَ بِقَلْبٍ طَاهِرٍ نَقِيٍّ، ثُمَّ دَعَاكَ بِصَوْتٍ حَائِلٍ خَفِيٍّ",
          "translation": "He stands before You with a pure heart, calling You in a trembling, humble voice,"
        },
        {
          "arabic": "قَدْ تَطَأْطَأَ لَكَ فَانْحَنَى، وَنَكَّسَ رَأْسَهُ فَانْثَنَى",
          "translation": "bowing in humility, lowering his head in submission,"
        },
        {
          "arabic": "قَدْ أَرْعَشَتْ خَشْيَتُهُ رِجْلَيْهِ، وَغَرَّقَتْ دُمُوعُهُ خَدَّيْهِ",
          "translation": "his legs trembling in awe, his cheeks drowned in tears,"
        },
        {
          "arabic": "يَدْعُوكَ: بِيَا أَرْحَمَ الرَّاحِمِينَ",
          "translation": "praying: “O Most Merciful of the merciful!"
        },
        {
          "arabic": "وَيَا أَرْحَمَ مَنِ انْتَابَهُ المُسْتَرْحِمُونَ، وَيَا أَعْطَفَ مَنْ أَطَافَ بِهِ المُسْتَغْفِرُونَ",
          "translation": "O Most Compassionate to those who seek Your mercy! O Kindest to those who seek Your forgiveness!"
        },
        {
          "arabic": "وَيَا مَنْ عَفْوُهُ أَكْثَرُ مِنْ نَقِمَتِهِ، وَيَا مَنْ رِضَاهُ أَوْفَرُ مِنْ سَخَطِهِ",
          "translation": "O You whose pardon exceeds Your wrath, whose pleasure outweighs Your displeasure!"
        },
        {
          "arabic": "وَيَا مَنْ تَحَمَّدَ إِلَى خَلْقِهِ بِحُسْنِ التَّجَاوُزِ، وَيَا مَنْ عَوَّدَ عِبَادَهُ قَبُولَ الإِنَابَةِ، وَيَا مَنِ اسْتَصْلَحَ فَاسِدَهُمْ بِالتَّوْبَةِ",
          "translation": "O You who are praised for Your gracious pardons! O You who accustom Your servants to return to You! O You who reform the corrupt through repentance!"
        },
        {
          "arabic": "وَيَا مَنْ رَضِيَ مِنْ فِعْلِهِمْ بِالْيَسِيرِ، وَيَا مَنْ كَافَى قَلِيلَهُمْ بِالْكَثِيرِ",
          "translation": "O You who accept their minimal good and reward their little with abundance!"
        },
        {
          "arabic": "وَيَا مَنْ ضَمِنَ لَهُمْ إِجَابَةَ الدُّعَاءِ، وَيَا مَنْ وَعَدَهُمْ عَلَى نَفْسِهِ بِتَفَضُّلِهِ حُسْنَ الجَزَاءِ",
          "translation": "O You who guarantee the answering of supplications! O You who promise them Your gracious reward!"
        },
        {
          "arabic": "مَا أَنَا بِأَعْصَى مَنْ عَصَاكَ فَغَفَرْتَ لَهُ، وَمَا أَنَا بِأَلْوَمِ مَنِ اعْتَذَرَ إِلَيْكَ فَقَبِلْتَ مِنْهُ، وَمَا أَنَا بِأَظْلَمِ مَنْ تَابَ إِلَيْكَ فَعُدْتَ عَلَيْهِ",
          "translation": "I am not the worst sinner You forgave, nor the most blameworthy whom You accepted, nor the most unjust whom You pardoned."
        },
        {
          "arabic": "أَتُوبُ إِلَيْكَ فِي مَقَامِي هَذَا تَوْبَةَ نَادِمٍ عَلَى مَا فَرَطَ مِنْهُ، مُشْفِقٍ مِمَّا اجْتَمَعَ عَلَيْهِ، خَالِصِ الحَيَاءِ مِمَّا وَقَعَ فِيهِ",
          "translation": "I repent to You now—a regretful repentance, fearful of my accumulated sins, sincerely ashamed of my misdeeds."
        },
        {
          "arabic": "عَالِمٍ بِأَنَّ العَفْوَ عَنِ الذَّنْبِ العَظِيمِ لَا يَتَعَاظَمُكَ، وَأَنَّ التَّجَاوُزَ عَنِ الإِثْمِ الجَلِيلِ لَا يَسْتَصْعِبُكَ، وَأَنَّ احْتِمَالَ الجِنَايَاتِ الفَاحِشَةِ لَا يَتَكَأَّدُكَ",
          "translation": "I know that forgiving grave sins does not burden You, overlooking enormous crimes does not weary You, and bearing heinous offenses does not strain You."
        },
        {
          "arabic": "وَأَنَّ أَحَبَّ عِبَادِكَ إِلَيْكَ مَنْ تَرَكَ الِاسْتِكْبَارَ عَلَيْكَ، وَجَانَبَ الِإِصْرَارَ، وَلَزِمَ الِاسْتِغْفَارَ",
          "translation": "Your most beloved servants are those who abandon arrogance, avoid persistence in sin, and cling to seeking forgiveness."
        },
        {
          "arabic": "وَأَنَا أَبْرَأُ إِلَيْكَ مِنْ أَنْ أَسْتَكْبِرَ، وَأَعُوذُ بِكَ مِنْ أَنْ أُصِرَّ، وَأَسْتَغْفِرُكَ لِمَا قَصَّرْتُ فِيهِ، وَأَسْتَعِينُ بِكَ عَلَى مَا عَجَزْتُ عَنْهُ",
          "translation": "I disown arrogance before You, seek refuge from stubbornness, ask forgiveness for my shortcomings, and seek Your help for my weaknesses."
        },
        {
          "arabic": "اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَآلِهِ وَهَبْ لِي مَا يَجِبُ عَلَيَّ ذلَكَ، وَعَافِنِي مِمَّا أَسْتَوْجِبُهُ مِنْكَ، وَأَجِرْنِي مِمَّا يَخَافُهُ أَهْلُ الإِسَاءَةِ",
          "translation": "O Allah, bless Muhammad and his progeny. Grant me what I need, protect me from what I deserve, and save me from the punishments feared by the sinful."
        },
        {
          "arabic": "فَإِنَّكَ مَلِي‌ءٌ بِالْعَفْوِ، مَرْجُوٌّ لِلْمَغْفِرَةِ، مَعْرُوفٌ بِالتَّجَاوُزِ",
          "translation": "For You are full of pardon, the hope for forgiveness, renowned for overlooking faults."
        },
        {
          "arabic": "لَيْسَ لِحَاجَتِي مَطْلَبٌ سِوَاكَ، وَلَا لِذَنْبِي غَافِرٌ غَيْرُكَ، حَاشَاكَ، وَلَا أَخَافُ عَلَى نَفْسِي إِلَّا إِيَّاكَ",
          "translation": "None but You can fulfill my needs, none but You can forgive my sins. Far are You from injustice! I fear none but You."
        },
        {
          "arabic": "إِنَّكَ أَهْلُ التَّقْوَى وَأَهْلُ المَغْفِرَةِ، صَلِّ عَلَى مُحَمَّدٍ وَآلِ مُحَمَّدٍ وَاقْضِ حَاجَتِي، وَأَنْجِحْ طَلِبَتِي، وَاغْفِرْ ذَنْبِي، وَآمِنْ خَوْفَ نَفْسِي",
          "translation": "You are worthy of reverence and forgiveness. Bless Muhammad and his family, grant my needs, fulfill my requests, forgive my sins, and ease my fears."
        },
        {
          "arabic": "إِنَّكَ عَلى كُلِّ شَيْ‌ءٍ قَدِيرٌ، وَذَلِكَ عَلَيْكَ يَسِيرٌ",
          "translation": "You are capable of all things, and this is effortless for You."
        },
        {
          "arabic": "آمِينَ رَبَّ العَالَمِينَ.",
          "translation": "Amen, Lord of the worlds."
        }
      ]
    }
  }
};

let currentStep = 1;
let totalSteps = 0;
let currentCategory = '';

// Initialization
document.addEventListener('DOMContentLoaded', function() {
  setupTopicCards();
  setupSwipeGestures();
});

function setupTopicCards() {
  document.querySelectorAll('.topic-card').forEach(card => {
    card.addEventListener('click', function() {
      currentCategory = this.dataset.category;
      if (hadithData[currentCategory]) {
        showHadithOptions(currentCategory);
      }
    });
  });
}

function setupSwipeGestures() {
  let touchStartX = 0;
  const swipeThreshold = 50;
  const stepsContainer = document.getElementById('steps-container');

  stepsContainer.addEventListener('touchstart', e => {
    touchStartX = e.touches[0].clientX;
  });

  stepsContainer.addEventListener('touchend', e => {
    const touchEndX = e.changedTouches[0].clientX;
    const deltaX = touchEndX - touchStartX;
    if (Math.abs(deltaX) > swipeThreshold) {
      deltaX > 0 ? previousStep() : nextStep();
    }
  });
}

function showMainPage() {
  document.querySelector('.topics-grid').classList.remove('hidden');
  document.getElementById('hadith-options').classList.add('hidden');
  document.getElementById('hadith-detail').classList.add('hidden');
}

function showHadithOptions(category) {
  const optionsGrid = document.querySelector('.hadith-options-grid');
  const optionsTitle = document.getElementById('options-title');
  
  optionsGrid.innerHTML = '';
  optionsTitle.textContent = category === 'wudhu' 
    ? 'Select a Wudhu Narration' 
    : 'Select a Supplication';

  Object.entries(hadithData[category]).forEach(([id, data]) => {
    const card = document.createElement('div');
    card.className = 'hadith-option-card';
    card.onclick = () => loadHadithDetail(id, category);
    card.innerHTML = `
      <h3>${data.title}</h3>
      <p>${data.steps[0].translation.substring(0, 60)}...</p>
    `;
    optionsGrid.appendChild(card);
  });

  document.querySelector('.topics-grid').classList.add('hidden');
  document.getElementById('hadith-options').classList.remove('hidden');
}

function loadHadithDetail(hadithId, category) {
  const hadith = hadithData[category][hadithId];
  const stepsContainer = document.getElementById('steps-container');
  
  stepsContainer.innerHTML = '';
  document.getElementById('hadith-title').textContent = hadith.title;

  hadith.steps.forEach((step, index) => {
    const stepDiv = document.createElement('div');
    stepDiv.className = 'wudhu-step' + (index === 0 ? ' active' : '');
    stepDiv.setAttribute('data-step', index + 1);
    stepDiv.innerHTML = `
      <div class="step-number">${index + 1}</div>
      <div class="step-text">
        <p class="arabic">${step.arabic}</p>
        <p class="translation">${step.translation}</p>
      </div>
    `;
    stepsContainer.appendChild(stepDiv);
  });

  currentStep = 1;
  totalSteps = hadith.steps.length;
  updateProgress();
  updateButtonState();

  document.getElementById('hadith-detail').classList.remove('hidden');
  document.getElementById('hadith-options').classList.add('hidden');
}

// Navigation functions
function nextStep() {
  if (currentStep < totalSteps) {
    document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
    currentStep++;
    document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
    updateProgress();
    updateButtonState();
    vibrate();
  }
}

function previousStep() {
  if (currentStep > 1) {
    document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
    currentStep--;
    document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
    updateProgress();
    updateButtonState();
    vibrate();
  }
}

function updateProgress() {
  const progressPercentage = (currentStep / totalSteps) * 100;
  document.querySelector('.progress').style.width = `${progressPercentage}%`;
}

function updateButtonState() {
  document.querySelector('.prev').disabled = currentStep === 1;
  document.querySelector('.next').disabled = currentStep === totalSteps;
}

function vibrate() {
  navigator.vibrate?.(10);
}