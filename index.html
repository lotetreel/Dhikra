<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sacred Reminders - Islamic Wisdom</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">Sacred Reminders</h1>
      <p class="subtitle">Explore authentic narrations from Islamic tradition</p>
    </div>

    <div class="topics-grid">
      <!-- Wudhu Card -->
      <div class="topic-card" data-category="wudhu">
        <div class="topic-icon">💦</div>
        <h2 class="topic-title">وضوء | Wudhu</h2>
        <p class="topic-description">
          Discover the beautiful traditions and supplications related to ritual purification
        </p>
      </div>

      <!-- Sahifa al-Sajjadiya Card -->
      <div class="topic-card" data-category="sajjadiya">
        <div class="topic-icon">📜</div>
        <h2 class="topic-title">الصحيفة السجادية | Sahifa al-Sajjadiya</h2>
        <p class="topic-description">
          Sacred supplications from Imam Zayn al-Abidin
        </p>
      </div>

      <!-- Other Topics -->
      <div class="topic-card">
        <div class="topic-icon">📿</div>
        <h2 class="topic-title">نوافل | Nawafil</h2>
        <p class="topic-description">
          Voluntary prayers and their spiritual significance
        </p>
      </div>

      <div class="topic-card">
        <div class="topic-icon">🌙</div>
        <h2 class="topic-title">شهر رمضان | The Month of Ramadan</h2>
        <p class="topic-description">
          Special traditions for the blessed month
        </p>
      </div>

      <div class="topic-card">
        <div class="topic-icon">🤲</div>
        <h2 class="topic-title">أدعية | Supplications</h2>
        <p class="topic-description">
          Daily duas from authentic sources
        </p>
      </div>

      <div class="topic-card">
        <div class="topic-icon">📖</div>
        <h2 class="topic-title">أخلاق | Ethics</h2>
        <p class="topic-description">
          Teachings on moral excellence and character
        </p>
      </div>
    </div>

    <!-- Hadith Options Section -->
    <section id="hadith-options" class="hidden">
      <div class="section-header">
        <button class="back-button" onclick="showMainPage()">← Back to Topics</button>
        <h2 id="options-title">Select a Hadith</h2>
      </div>
      <div class="hadith-options-grid"></div>
    </section>

    <!-- Hadith Detail Section -->
    <section id="hadith-detail" class="hidden">
      <div class="section-header">
        <button class="back-button" onclick="showHadithOptions(currentCategory)">← Back to Options</button>
        <h2 id="hadith-title">Hadith Title</h2>
      </div>
      <div class="progress-bar">
        <div class="progress"></div>
      </div>
      <div class="wudhu-steps" id="steps-container"></div>
      <div class="navigation-controls">
        <button class="nav-btn prev" onclick="previousStep()">Previous</button>
        <button class="nav-btn next" onclick="nextStep()">Next</button>
      </div>
    </section>
  </div>

  <script>
    // Global Variables
    let hadithData = {};  // Will be populated from data/data.json
    let currentStep = 1;
    let totalSteps = 0;
    let currentCategory = '';

    // Fetch the hadith data from the JSON file.
    function loadHadithData() {
      fetch('data/data.json')
        .then(response => response.json())
        .then(data => {
          hadithData = data;
          setupTopicCards();
        })
        .catch(err => console.error("Error loading hadith data:", err));
    }

    // Initialization when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadHadithData();
      setupSwipeGestures();
    });

    // Set up click events for topic cards.
    function setupTopicCards() {
      document.querySelectorAll('.topic-card').forEach(card => {
        card.addEventListener('click', function() {
          currentCategory = this.dataset.category;
          if (hadithData[currentCategory]) {
            showHadithOptions(currentCategory);
          }
        });
      });
    }

    // Set up swipe gestures for navigating steps.
    function setupSwipeGestures() {
      let touchStartX = 0;
      const swipeThreshold = 50;
      const stepsContainer = document.getElementById('steps-container');

      stepsContainer.addEventListener('touchstart', e => {
        touchStartX = e.touches[0].clientX;
      });

      stepsContainer.addEventListener('touchend', e => {
        const touchEndX = e.changedTouches[0].clientX;
        const deltaX = touchEndX - touchStartX;
        if (Math.abs(deltaX) > swipeThreshold) {
          deltaX > 0 ? previousStep() : nextStep();
        }
      });
    }

    // Show the main topics page.
    function showMainPage() {
      document.querySelector('.topics-grid').classList.remove('hidden');
      document.getElementById('hadith-options').classList.add('hidden');
      document.getElementById('hadith-detail').classList.add('hidden');
    }

    // Show the options page for the selected category.
    function showHadithOptions(category) {
      const optionsGrid = document.querySelector('.hadith-options-grid');
      const optionsTitle = document.getElementById('options-title');

      optionsGrid.innerHTML = '';
      optionsTitle.textContent = category === 'wudhu' 
        ? 'Select a Wudhu Narration' 
        : 'Select a Supplication';

      Object.entries(hadithData[category]).forEach(([id, data]) => {
        const card = document.createElement('div');
        card.className = 'hadith-option-card';
        card.onclick = () => loadHadithDetail(id, category);
        card.innerHTML = `
          <h3>${data.title}</h3>
          <p>${data.steps[0].translation.substring(0, 60)}...</p>
        `;
        optionsGrid.appendChild(card);
      });

      document.querySelector('.topics-grid').classList.add('hidden');
      document.getElementById('hadith-options').classList.remove('hidden');
      document.getElementById('hadith-detail').classList.add('hidden');
    }

    // Load and display the detailed view of a hadith/supplication.
    function loadHadithDetail(hadithId, category) {
      const hadith = hadithData[category][hadithId];
      const stepsContainer = document.getElementById('steps-container');

      stepsContainer.innerHTML = '';
      document.getElementById('hadith-title').textContent = hadith.title;

      hadith.steps.forEach((step, index) => {
        const stepDiv = document.createElement('div');
        stepDiv.className = 'wudhu-step' + (index === 0 ? ' active' : '');
        stepDiv.setAttribute('data-step', index + 1);
        stepDiv.innerHTML = `
          <div class="step-number">${index + 1}</div>
          <div class="step-text">
            <p class="arabic">${step.arabic}</p>
            <p class="translation">${step.translation}</p>
          </div>
        `;
        stepsContainer.appendChild(stepDiv);
      });

      currentStep = 1;
      totalSteps = hadith.steps.length;
      updateProgress();
      updateButtonState();

      document.querySelector('.topics-grid').classList.add('hidden');
      document.getElementById('hadith-options').classList.add('hidden');
      document.getElementById('hadith-detail').classList.remove('hidden');
    }

    // Navigation functions.
    function nextStep() {
      if (currentStep < totalSteps) {
        document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
        currentStep++;
        document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
        updateProgress();
        updateButtonState();
        vibrate();
      }
    }

    function previousStep() {
      if (currentStep > 1) {
        document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
        currentStep--;
        document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
        updateProgress();
        updateButtonState();
        vibrate();
      }
    }

    // Update the progress bar.
    function updateProgress() {
      const progressPercentage = (currentStep / totalSteps) * 100;
      document.querySelector('.progress').style.width = `${progressPercentage}%`;
    }

    // Enable/disable navigation buttons based on current step.
    function updateButtonState() {
      document.querySelector('.prev').disabled = currentStep === 1;
      document.querySelector('.next').disabled = currentStep === totalSteps;
    }

    // Trigger a short vibration (if supported).
    function vibrate() {
      navigator.vibrate?.(10);
    }
  </script>
</body>
</html>